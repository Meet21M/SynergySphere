<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>SynergySphere - Verify Code</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
            --primary-50: #f0fdf6;
            --primary-100: #dcfce9;
            --primary-200: #bbf7d4;
            --primary-300: #86efb0;
            --primary-400: #4ade8a;
            --primary-500: #22c55e;
            --primary-600: #16a34a;
            --primary-700: #15803d;
            --primary-800: #166534;
            --primary-900: #14532d;
            --primary-950: #052e16;
        }

        body {
            font-family: "Spline Sans", sans-serif;
        }

        /* Animation for the success checkmark */
        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark {
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        /* Animation for incorrect OTP shake */
        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }
        .shake {
            animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>

<body class="bg-gray-900 text-white antialiased">
    <div class="flex h-screen w-full flex-col">
        <header class="flex items-center justify-center px-4 py-6 sm:px-6">
            <a class="flex items-center gap-3" href="SignInPage.html">
                <svg class="h-8 w-8 text-[var(--primary-400)]" fill="none" viewBox="0 0 48 48"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z"
                        fill="currentColor"></path>
                </svg>
                <h1 class="text-2xl font-bold tracking-tight">SynergySphere</h1>
            </a>
        </header>
        <main class="flex flex-1 items-center justify-center px-4 sm:px-6">
            <div class="w-full max-w-md space-y-8">

                <div id="otp-section">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Check your email</h2>
                        <p class="mt-2 text-lg text-gray-400">We've sent a 6-digit code to you@example.com</p>
                    </div>
                    <form id="otp-form" class="space-y-6 rounded-2xl bg-gray-800/50 p-8 shadow-2xl backdrop-blur-sm mt-8">
                        <div class="flex justify-center gap-2" id="otp-container">
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                            <span class="self-center text-xl text-gray-500">-</span>
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                            <input class="otp-input h-14 w-12 rounded-lg border-gray-700 bg-gray-900/70 text-center text-2xl font-bold text-white transition-colors focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" maxlength="1" type="text" inputmode="numeric" />
                        </div>
                        <div>
                            <button class="mt-4 w-full rounded-full bg-[var(--primary-500)] px-5 py-3 text-base font-semibold text-white shadow-sm transition-colors hover:bg-[var(--primary-600)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--primary-500)]" type="submit">
                                Verify
                            </button>
                        </div>
                    </form>
                    <p id="resend-container" class="mt-8 text-center text-sm text-gray-400">
                        Didn't receive the code?
                        <a id="resend-link" class="font-medium text-[var(--primary-400)] hover:text-[var(--primary-300)]" href="#">Resend Code</a>
                    </p>
                </div>

                <div id="success-animation" class="hidden flex-col items-center justify-center text-center">
                    <svg class="h-24 w-24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" stroke="var(--primary-500)" stroke-width="4"/>
                        <path class="checkmark" fill="none" stroke="var(--primary-500)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" d="M14 27l8 8 16-16"/>
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold text-white">Verified!</h2>
                    <p class="text-lg text-gray-400">You can now set a new password.</p>
                </div>

                <div id="new-password-section" class="hidden">
                     <div class="text-center">
                         <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">Set New Password</h2>
                         <p class="mt-2 text-lg text-gray-400">Your new password must be secure and different from previous ones.</p>
                     </div>
                    <form id="password-reset-form" class="space-y-4 rounded-2xl bg-gray-800/50 p-8 shadow-2xl backdrop-blur-sm mt-8">
                        <div class="space-y-2">
                            <label class="text-sm font-medium text-gray-300" for="new-password">New Password</label>
                            <div class="relative">
                                <input class="form-input w-full rounded-lg border-gray-700 bg-gray-900/70 py-3 pr-10 text-white placeholder:text-gray-500 focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" id="new-password" name="password" placeholder="••••••••" required="" type="password"/>
                                <button type="button" class="password-toggle absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white">
                                    <span class="material-symbols-outlined">visibility_off</span>
                                </button>
                            </div>
                             <div id="password-rules" class="pt-2 text-xs text-gray-500 space-y-1">
                                 <p class="font-medium text-gray-400">Your password must include:</p>
                                 <div id="rule-length" class="flex items-center gap-2 transition-colors">
                                     <span class="material-symbols-outlined text-sm rule-icon">cancel</span>
                                     <span class="rule-text">At least 8 characters</span>
                                 </div>
                                 <div id="rule-uppercase" class="flex items-center gap-2 transition-colors">
                                     <span class="material-symbols-outlined text-sm rule-icon">cancel</span>
                                     <span class="rule-text">One uppercase letter (A-Z)</span>
                                 </div>
                                 <div id="rule-lowercase" class="flex items-center gap-2 transition-colors">
                                     <span class="material-symbols-outlined text-sm rule-icon">cancel</span>
                                     <span class="rule-text">One lowercase letter (a-z)</span>
                                 </div>
                                 <div id="rule-number" class="flex items-center gap-2 transition-colors">
                                     <span class="material-symbols-outlined text-sm rule-icon">cancel</span>
                                     <span class="rule-text">One number (0-9)</span>
                                 </div>
                                 <div id="rule-special" class="flex items-center gap-2 transition-colors">
                                     <span class="material-symbols-outlined text-sm rule-icon">cancel</span>
                                     <span class="rule-text">One special character (!, $, #, etc.)</span>
                                 </div>
                             </div>
                        </div>
                         <div class="space-y-2">
                             <label class="text-sm font-medium text-gray-300" for="confirm-password">Confirm Password</label>
                             <div class="relative">
                                <input class="form-input w-full rounded-lg border-gray-700 bg-gray-900/70 py-3 pr-10 text-white placeholder:text-gray-500 focus:border-[var(--primary-400)] focus:ring-[var(--primary-400)]" id="confirm-password" name="confirm-password" placeholder="••••••••" required="" type="password"/>
                                <button type="button" class="password-toggle absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white">
                                    <span class="material-symbols-outlined">visibility_off</span>
                                </button>
                            </div>
                            <div id="rule-match" class="hidden flex items-center gap-2 text-xs pt-2 transition-colors">
                                <span class="material-symbols-outlined text-sm"></span>
                                <span></span>
                            </div>
                         </div>
                        <div class="pt-4">
                             <button id="reset-button" class="flex w-full items-center justify-center rounded-full bg-[var(--primary-500)] px-5 py-3 text-base font-semibold text-white shadow-sm transition-colors hover:bg-[var(--primary-600)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--primary-500)] disabled:opacity-60 disabled:cursor-not-allowed" type="submit">
                                 <span id="reset-button-text">Reset Password</span>
                                 <svg id="reset-button-spinner" class="hidden h-5 w-5 animate-spin text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                     <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                     <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                 </svg>
                             </button>
                        </div>
                    </form>
                </div>
                
                 <div id="final-success-message" class="hidden text-center">
                     <h2 class="text-3xl font-bold tracking-tight text-[var(--primary-400)] sm:text-4xl">Password Reset!</h2>
                     <p class="mt-4 text-lg text-gray-400">Your password has been successfully updated. Redirecting you to the login page...</p>
                </div>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const otpSection = document.getElementById('otp-section');
            const successSection = document.getElementById('success-animation');
            const newPasswordSection = document.getElementById('new-password-section');
            const finalSuccessMessage = document.getElementById('final-success-message');

            const otpContainer = document.getElementById('otp-container');
            const otpForm = document.getElementById('otp-form');
            const inputs = otpContainer.querySelectorAll('.otp-input');
            const resendContainer = document.getElementById('resend-container');
            const resendLink = document.getElementById('resend-link');
            
            const correctOTP = '123456';

            // --- OTP Input Logic ---
            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (input.value.length === 1 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                    if (Array.from(inputs).every(i => i.value.length === 1)) {
                        verifyOTP();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        inputs[index - 1].focus();
                    }
                });
                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pasteData = e.clipboardData.getData('text').slice(0, 6);
                    if (/^\d+$/.test(pasteData)) {
                        let currentInput = 0;
                        for (let i = 0; i < pasteData.length; i++) {
                            if (currentInput < inputs.length) {
                                inputs[currentInput].value = pasteData[i];
                                if (currentInput < inputs.length - 1) currentInput++;
                            }
                        }
                        inputs[currentInput].focus();
                        if (pasteData.length === 6) verifyOTP();
                    }
                });
            });

            // --- OTP Verification Logic ---
            function verifyOTP() {
                let enteredOTP = Array.from(inputs).map(i => i.value).join('');
                if (enteredOTP === correctOTP) {
                    handleSuccess();
                } else {
                    handleError();
                }
            }
            
            otpForm.addEventListener('submit', (e) => {
                e.preventDefault();
                verifyOTP();
            });

            function handleError() {
                otpForm.classList.add('shake');
                inputs.forEach(input => input.classList.add('border-red-500'));
                setTimeout(() => {
                    otpForm.classList.remove('shake');
                     inputs.forEach(input => {
                         input.classList.remove('border-red-500');
                         input.value = '';
                     });
                    inputs[0].focus();
                }, 1000);
            }

            function handleSuccess() {
                otpSection.classList.add('hidden');
                successSection.classList.remove('hidden');
                successSection.classList.add('flex');
                
                setTimeout(() => {
                    successSection.classList.add('hidden');
                    successSection.classList.remove('flex');
                    newPasswordSection.classList.remove('hidden');
                    activatePasswordValidation();
                }, 2000);
            }

            // --- Resend Code Logic ---
            resendLink.addEventListener('click', (e) => {
                e.preventDefault();
                let countdown = 30;
                resendContainer.innerHTML = `Resend available in <span class="font-bold text-white">${countdown}s</span>`;
                
                const interval = setInterval(() => {
                    countdown--;
                    resendContainer.innerHTML = `Resend available in <span class="font-bold text-white">${countdown}s</span>`;
                    if (countdown <= 0) {
                        clearInterval(interval);
                        resendContainer.innerHTML = `Didn't receive the code? <a id="resend-link" class="font-medium text-[var(--primary-400)] hover:text-[var(--primary-300)]" href="#">Resend Code</a>`;
                        // Re-add event listener to the new link
                        document.getElementById('resend-link').addEventListener('click', (e) => {
                             e.preventDefault();
                             // Add your resend logic here
                        });
                    }
                }, 1000);
            });

            // --- PASSWORD VALIDATION SCRIPT ---
            function activatePasswordValidation() {
                const passwordForm = document.getElementById('password-reset-form');
                const passwordInput = document.getElementById('new-password');
                const confirmInput = document.getElementById('confirm-password');
                const passwordToggles = document.querySelectorAll('.password-toggle');
                const resetButton = document.getElementById('reset-button');
                const resetButtonText = document.getElementById('reset-button-text');
                const resetButtonSpinner = document.getElementById('reset-button-spinner');

                const rules = {
                    length: { el: document.getElementById('rule-length'), regex: /.{8,}/, valid: false },
                    uppercase: { el: document.getElementById('rule-uppercase'), regex: /[A-Z]/, valid: false },
                    lowercase: { el: document.getElementById('rule-lowercase'), regex: /[a-z]/, valid: false },
                    number: { el: document.getElementById('rule-number'), regex: /[0-9]/, valid: false },
                    special: { el: document.getElementById('rule-special'), regex: /[^A-Za-z0-9]/, valid: false },
                    match: { el: document.getElementById('rule-match'), valid: false }
                };

                passwordToggles.forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        const input = toggle.previousElementSibling;
                        const icon = toggle.querySelector('.material-symbols-outlined');
                        if (input.type === 'password') {
                            input.type = 'text';
                            icon.textContent = 'visibility';
                        } else {
                            input.type = 'password';
                            icon.textContent = 'visibility_off';
                        }
                    });
                });

                const validatePassword = () => {
                    const password = passwordInput.value;
                    for (const ruleName in rules) {
                        if (rules[ruleName].regex) {
                            const { el, regex } = rules[ruleName];
                            const icon = el.querySelector('.rule-icon');
                            if (regex.test(password)) {
                                el.classList.remove('text-gray-500');
                                el.classList.add('text-[var(--primary-400)]');
                                icon.textContent = 'check_circle';
                                rules[ruleName].valid = true;
                            } else {
                                el.classList.add('text-gray-500');
                                el.classList.remove('text-[var(--primary-400)]');
                                icon.textContent = 'cancel';
                                rules[ruleName].valid = false;
                            }
                        }
                    }
                    validateMatch();
                };

                const validateMatch = () => {
                    const { el } = rules.match;
                    const icon = el.querySelector('.material-symbols-outlined');
                    const text = el.querySelector('span:last-child');
                    if (confirmInput.value && passwordInput.value) {
                        el.classList.remove('hidden');
                        if (confirmInput.value === passwordInput.value) {
                            el.classList.remove('text-red-400');
                            el.classList.add('text-[var(--primary-400)]');
                            icon.textContent = 'check_circle';
                            text.textContent = 'Passwords match';
                            rules.match.valid = true;
                        } else {
                            el.classList.remove('text-[var(--primary-400)]');
                            el.classList.add('text-red-400');
                            icon.textContent = 'cancel';
                            text.textContent = 'Passwords do not match';
                            rules.match.valid = false;
                        }
                    } else {
                        el.classList.add('hidden');
                         rules.match.valid = false;
                    }
                };

                passwordInput.addEventListener('input', validatePassword);
                confirmInput.addEventListener('input', validateMatch);

                passwordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Final check on submit
                    validatePassword(); 
                    const isAllValid = Object.values(rules).every(rule => rule.valid);
                    
                    if (isAllValid) {
                        resetButtonText.textContent = 'Resetting...';
                        resetButtonSpinner.classList.remove('hidden');
                        resetButton.disabled = true;

                        setTimeout(() => {
                           newPasswordSection.classList.add('hidden');
                           finalSuccessMessage.classList.remove('hidden');

                           setTimeout(() => {
                               // Redirect to login page
                               window.location.href = "SignInPage.html";
                           }, 3000);
                        }, 1500);
                    } else {
                        passwordForm.classList.add('shake');
                        setTimeout(() => passwordForm.classList.remove('shake'), 820);
                    }
                });
            }
        });
    </script>

</body>

</html>